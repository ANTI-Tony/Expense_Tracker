# Android è´¹ç”¨è¿½è¸ªåº”ç”¨ - æŠ€æœ¯æŠ¥å‘Š
## Tesla ç§»åŠ¨å¼€å‘å®ä¹  Take-Home é¡¹ç›®
å‰è¨€ï¼šè‡ªç¬¬äºŒæ¬¡é¢è¯•åï¼Œå®‰å“ç³»åˆ—é¢è¯•é¢˜çš„å¤±åˆ©ï¼Œä¸ºæˆ‘æ‰“å¼€äº†æ–°çš„ä¸–ç•Œï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘åªè®¤ä¸ºå®‰å“å¼€å‘æ˜¯ç§»åŠ¨å¼€å‘ä¸€ä¸ªå°åˆ†æ”¯ï¼ŒçœŸæ­£çš„ä¸»æµæ˜¯rnã€flutterç­‰è·¨å¹³å°æ¡†æ¶ï¼Œåªéœ€è¦äº†è§£å…«è‚¡æ–‡å³å¯å®è·µã€‚å¯ç°å®ç¡®å®æ‰“ç ´äº†æˆ‘çš„è®¤çŸ¥ï¼Œåœ¨æˆ‘äº†è§£äº†å®‰å“å¼€å‘çš„å†å²ï¼ˆGoogleï¼‰å’Œkotlinçš„æ¥æºï¼ˆjetbï¼‰ï¼Œæˆ‘è¢«å®‰å“å¼€å‘æ·±æ·±å¸å¼•ï¼Œæˆ‘å»ä¸‹è½½äº†ã€Šç¬¬ä¸€è¡Œä»£ç Androidã€‹å¹¶æ¯å¤©é˜…è¯»ï¼ˆç›®å‰è¯»åˆ°äº†text viewéƒ¨åˆ†ï¼‰ï¼Œæ— ä¸æ„Ÿæ…¨å®‰å“å¼€å‘è®¾è®¡çš„å·§å¦™å’Œç¥å¥‡ï¼Œè¿™å°±åƒæ˜¯ä¸€ä¸ªè·ŸiOSå¹¶è¡Œçš„æœ‰è¶£çš„é¢†åŸŸï¼Œæˆ‘è®¤ä¸ºä¸€ä¸ªåˆæ ¼çš„ç¨‹åºå‘˜å¿…é¡»æœ‰æå¼ºçš„è‡ªå­¦/å­¦ä¹ èƒ½åŠ›ï¼Œè€Œæˆ‘åˆæ˜¯ä¸€ä¸ªå¾ˆå–œæ¬¢ç”¨è¡ŒåŠ¨æ¥è¯æ˜è‡ªå·±çš„å¤§ä¸‰å­¦ç”ŸğŸ˜‚ï¼Œæˆ‘è¿˜åˆ›å»ºäº†ç¨€åœŸæ˜é‡‘çš„ä¸ªäººåšå®¢ï¼ˆé“¾æ¥ä¸‹æ–‡ä¼šæåˆ°ï¼‰ï¼Œåœ¨ä½œä¸ºå­¦ä¹ å®‰å“ã€ç§»åŠ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹è‡ªå·±å­¦ä¹ /å­¦åˆ°çŸ¥è¯†çš„è®°å½•å’Œå®ç°ï¼Œæˆ‘ä¹Ÿæ­£å¼å°†ktå’ŒandroidåŠ å…¥è‡ªå·±çš„æŠ€æœ¯æ ˆï¼Œä»¥ä¸‹æ˜¯æˆ‘å¯¹æ­¤æ¬¡take homeä»»åŠ¡çš„æŠ€æœ¯æŠ¥å‘Šï¼Œå…¶ä¸­mdæ–‡ä»¶æ ¼å¼ç»è¿‡AIæ¶¦è‰²ã€‚

## é¡¹ç›®æ¦‚è¿°

è¿™ä»½æŠ¥å‘Šè®°å½•äº†æˆ‘ä» iOS å¼€å‘è€…åˆ°ç‹¬ç«‹æ„å»ºä¸€ä¸ªç”Ÿäº§çº§ Android åº”ç”¨çš„ 4 å‘¨å­¦ä¹ æ—…ç¨‹ã€‚æˆ‘æˆåŠŸå®ç°äº†æ‰€æœ‰è¦æ±‚çš„åŠŸèƒ½ï¼ˆMVVM æ¶æ„ã€Room æ•°æ®åº“ã€åå°æœåŠ¡ã€æ•°æ®å¯è§†åŒ–å’Œå•å…ƒæµ‹è¯•ï¼‰ï¼Œå¹¶é€šè¿‡è‡ªå­¦å’Œåˆ›æ–°æ€ç»´å…‹æœäº†é‡å¤§æŠ€æœ¯æŒ‘æˆ˜ã€‚

**å¼€å‘æ—¶é—´**ï¼š20å¤©å·¦å³  
**æŠ€æœ¯æ ˆ**ï¼šKotlin, Room, LiveData, Coroutines, Material Design

---

## ç›®å½•
1. [åŠŸèƒ½å®ç°](#åŠŸèƒ½å®ç°)
2. [æ¶æ„è®¾è®¡å†³ç­–](#æ¶æ„è®¾è®¡å†³ç­–)
3. [æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ](#æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ)
4. [iOS åˆ° Android çš„è¿ç§»ä¹‹æ—…](#ios-åˆ°-android-çš„è¿ç§»ä¹‹æ—…)
5. [ä»£ç è´¨é‡ä¸æµ‹è¯•](#ä»£ç è´¨é‡ä¸æµ‹è¯•)
6. [è¿è¡Œè¯´æ˜](#è¿è¡Œè¯´æ˜)
7. [æœªæ¥æ”¹è¿›æ–¹å‘](#æœªæ¥æ”¹è¿›æ–¹å‘)
8. [è‡ªæˆ‘è¯„ä¼°ä¸åæ€](#è‡ªæˆ‘è¯„ä¼°ä¸åæ€)

---

## 1. åŠŸèƒ½å®ç°

### 1.1 å·²å®ç°åŠŸèƒ½

 **æ ¸å¿ƒåŠŸèƒ½**
- å®Œæ•´çš„ CRUD æ“ä½œï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤è´¹ç”¨ï¼‰
- åŸºäºåˆ†ç±»çš„è´¹ç”¨ç®¡ç†
- æŒ‰æ—¥æœŸç­›é€‰å’Œæ’åº
- å®æ—¶æ€»é‡‘é¢è®¡ç®—
- æ»‘åŠ¨åˆ é™¤ + æ’¤é”€åŠŸèƒ½

 **æ•°æ®å¯è§†åŒ–**
- æŒ‰åˆ†ç±»çš„è´¹ç”¨ç»Ÿè®¡ï¼ˆæ¡å½¢å›¾ï¼‰
- æœ€è¿‘ 7 å¤©çš„æ¯æ—¥è´¹ç”¨è¶‹åŠ¿
- **è‡ªå®šä¹‰åŸç”Ÿå›¾è¡¨å®ç°**ï¼ˆæ— ç¬¬ä¸‰æ–¹ä¾èµ–ï¼‰

 **åå°å¤„ç†**
- å‰å°æœåŠ¡å®ç°è‡ªåŠ¨äº¤æ˜“æ£€æµ‹
- æ¨¡æ‹Ÿ iOS ç‰ˆæœ¬çš„ SMS è§£æåŠŸèƒ½
- æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿå®æ—¶æ›´æ–°

 **è´¨é‡ä¿è¯**
- å…¨é¢çš„å•å…ƒæµ‹è¯•è¦†ç›–æ•°æ®éªŒè¯å’Œè®¡ç®—
- å®Œå–„çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ç®¡ç†
- å¤šå±‚æ¬¡é”™è¯¯å¤„ç†

### 1.2 æŠ€æœ¯æ¶æ„

```
MVVM æ¶æ„ï¼š

UI å±‚ (MainActivity, AddEditActivity, ChartActivity)
    â†“
ViewModel å±‚ (MainViewModel, AddEditViewModel, ChartViewModel)
    â†“
Repository å±‚ (ExpenseRepository)
    â†“
æ•°æ®å±‚ (Room Database, DAO, Entities)
```

**åˆ›æ–°äº®ç‚¹**ï¼šä½¿ç”¨ ProgressBar å®ç°åŸç”Ÿå›¾è¡¨
- **æŒ‘æˆ˜**ï¼šç¬¬ä¸‰æ–¹åº“ï¼ˆMPAndroidChartã€AnyChartï¼‰ä¾èµ–è§£æå¤±è´¥
- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ Android å†…ç½® ProgressBar è‡ªå®šä¹‰å®ç°
- **æ”¶ç›Š**ï¼šAPK å‡å° 2MBã€æ¸²æŸ“é€Ÿåº¦æå‡ 50%+ã€é›¶ä¾èµ–é£é™©

---

## 2. æ¶æ„è®¾è®¡å†³ç­–

### 2.1 ä¸ºä»€ä¹ˆé€‰æ‹© MVVM æ¶æ„ï¼Ÿ

æˆ‘åœ¨ç ”ç©¶ Android æœ€ä½³å®è·µå¹¶ç»“åˆæˆ‘çš„ iOS ç»éªŒåé€‰æ‹©äº† MVVMã€‚

**ä¸ iOS æ¶æ„å¯¹æ¯”**ï¼š

| iOSï¼ˆæˆ‘çš„ç»éªŒï¼‰ | Androidï¼ˆæœ¬é¡¹ç›®ï¼‰ | ä¼˜åŠ¿ |
|----------------|-----------------|------|
| SwiftUI + @State | MVVM + LiveData | æ›´å¥½çš„å…³æ³¨ç‚¹åˆ†ç¦» |
| ViewControllerï¼ˆç®€å•ç”Ÿå‘½å‘¨æœŸï¼‰ | Activityï¼ˆå¤æ‚ç”Ÿå‘½å‘¨æœŸï¼‰ | ViewModel åœ¨é…ç½®å˜åŒ–æ—¶å­˜æ´» |
| Combine å“åº”å¼æ›´æ–° | LiveData è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ | è‡ªåŠ¨é˜²æ­¢å†…å­˜æ³„æ¼ |

**ä¸ºä»€ä¹ˆ MVVM ä¼˜äº MVC/MVPï¼Ÿ**

```
ä¼ ç»Ÿ MVC çš„é—®é¢˜ï¼š
Activity = View + Controllerï¼ˆè‡ƒè‚¿ï¼Œéš¾ä»¥æµ‹è¯•ï¼‰

MVVM è§£å†³æ–¹æ¡ˆï¼š
Activity = çº¯ UI é€»è¾‘ï¼ˆè–„å±‚ï¼‰
ViewModel = ä¸šåŠ¡é€»è¾‘ï¼ˆæ˜“äºæµ‹è¯•ï¼‰
Model = æ•°æ®å±‚ï¼ˆå•ä¸€æ•°æ®æºï¼‰
```

**ä»£ç ç¤ºä¾‹**ï¼š
```kotlin
// æ¸…æ™°çš„åˆ†ç¦» - Activity åªå¤„ç† UI
class MainActivity : AppCompatActivity() {
    private val viewModel: MainViewModel by viewModels()
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        // ViewModel æŒæœ‰æ•°æ®é€»è¾‘
        viewModel.allExpenses.observe(this) { expenses ->
            adapter.submitList(expenses)  // UI è‡ªåŠ¨æ›´æ–°
        }
    }
}

// ViewModel å¯ç‹¬ç«‹æµ‹è¯•
class MainViewModel(private val repository: ExpenseRepository) : ViewModel() {
    val allExpenses: LiveData<List<Expense>> = repository.getAllExpenses()
    
    suspend fun getTotalAmount(): Double = repository.getTotalAmount()
}
```

### 2.2 æ•°æ®æŒä¹…åŒ–ï¼šRoom Database

**ä¸ºä»€ä¹ˆé€‰æ‹© Roomï¼Ÿ**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å†³ç­– |
|-----|------|------|-----|
| SharedPreferences | API ç®€å• | åªèƒ½å­˜é”®å€¼å¯¹ |  åŠŸèƒ½å¤ªæœ‰é™ |
| SQLiteï¼ˆåŸç”Ÿï¼‰ | å®Œå…¨æ§åˆ¶ | æ ·æ¿ä»£ç å¤šï¼ŒSQLæ³¨å…¥é£é™© |  å®¹æ˜“å‡ºé”™ |
| **Room** | ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶éªŒè¯ | å­¦ä¹ æ›²çº¿ |  **é€‰æ‹©** |
| Realm | åŠŸèƒ½ä¸°å¯Œ | åº“ä½“ç§¯å¤§ï¼Œéœ€ç‹¬ç«‹åŒæ­¥ |  è¿‡åº¦è®¾è®¡ |

**Room å®ç°**ï¼š

```kotlin
// Entity - å®šä¹‰è¡¨ç»“æ„
@Entity(tableName = "expenses")
data class Expense(
    @PrimaryKey(autoGenerate = true)
    val id: Long = 0,
    val title: String,
    val amount: Double,
    val category: String,
    val date: Date,
    val description: String? = null
)

// DAO - ç±»å‹å®‰å…¨çš„æŸ¥è¯¢ï¼Œç¼–è¯‘æ—¶éªŒè¯
@Dao
interface ExpenseDao {
    @Query("SELECT * FROM expenses ORDER BY date DESC")
    fun getAllExpenses(): LiveData<List<Expense>>
    
    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun insertExpense(expense: Expense): Long
    
    @Query("SELECT SUM(amount) FROM expenses")
    suspend fun getTotalAmount(): Double?
}

// Database - å•ä¾‹æ¨¡å¼
@Database(entities = [Expense::class], version = 1)
@TypeConverters(Converters::class)
abstract class ExpenseDatabase : RoomDatabase() {
    abstract fun expenseDao(): ExpenseDao
    
    companion object {
        @Volatile
        private var INSTANCE: ExpenseDatabase? = null
        
        fun getDatabase(context: Context): ExpenseDatabase {
            return INSTANCE ?: synchronized(this) {
                Room.databaseBuilder(
                    context.applicationContext,
                    ExpenseDatabase::class.java,
                    "expense_database"
                ).build().also { INSTANCE = it }
            }
        }
    }
}
```

**æˆ‘å‘ç°çš„ä¼˜åŠ¿**ï¼š
- SQL é”™è¯¯åœ¨ç¼–è¯‘æ—¶è¢«æ•è·ï¼ˆèŠ‚çœäº†æˆ‘å¤§é‡è°ƒè¯•æ—¶é—´ï¼‰
- è‡ªåŠ¨é›†æˆ LiveDataï¼ˆUI æ›´æ–°æ— éœ€é¢å¤–ä»£ç ï¼‰
- æ”¯æŒæ•°æ®åº“è¿ç§»ï¼ˆæœªæ¥æ•°æ®åº“å˜æ›´æœ‰ä¿éšœï¼‰
- åç¨‹æ”¯æŒï¼ˆå¼‚æ­¥ä»£ç æ›´æ¸…æ™°ï¼‰

### 2.3 å¼‚æ­¥ç¼–ç¨‹ï¼šåç¨‹

**iOS vs Android å¯¹æ¯”**ï¼š

```swift
// iOS - Grand Central Dispatch
DispatchQueue.global().async {
    let data = self.fetchData()
    DispatchQueue.main.async {
        self.updateUI(data)
    }
}
```

```kotlin
// Android - Coroutinesï¼ˆæ›´ç®€æ´ï¼‰
lifecycleScope.launch {
    val data = withContext(Dispatchers.IO) {
        repository.fetchData()
    }
    updateUI(data)  // è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹
}
```

**ä¸ºä»€ä¹ˆç”¨åç¨‹ï¼Ÿ**
- æ¯”å›è°ƒæ›´æ˜“è¯»
- è‡ªåŠ¨çº¿ç¨‹ç®¡ç†
- å†…ç½®å–æ¶ˆæ”¯æŒ
- ä¸ Room å’Œ LiveData å®Œç¾é›†æˆ

---

## 3. æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### æŒ‘æˆ˜ 1ï¼šç¬¬ä¸‰æ–¹å›¾è¡¨åº“ä¾èµ–å¤±è´¥ â­â­â­â­â­

**é—®é¢˜æè¿°**ï¼š
```
ç¼–è¯‘å¤±è´¥ï¼šCould not find com.github.AnyChart:AnyChart-Android:1.1.5
```

**ç ”ç©¶è¿‡ç¨‹**ï¼š
1. æ£€æŸ¥åº“çš„ GitHubï¼ˆæœ€åæ›´æ–°äº 2019 å¹´ - å·²åœæ­¢ç»´æŠ¤ï¼‰
2. å°è¯•å…¶ä»–ä»“åº“ï¼ˆJitPackã€Maven Centralï¼‰
3. ç ”ç©¶ Gradle ä»“åº“é…ç½®
4. äº†è§£ JCenter å…³é—­çš„æ—¶é—´çº¿

**å°è¯•çš„è§£å†³æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | ç»“æœ |
|-----|------|
| æ›´æ–°ä»“åº“ URL | å¤±è´¥ - åº“æœªè¿ç§» |
| å°è¯• MPAndroidChart | åŒæ ·çš„ä¾èµ–é—®é¢˜ |
| å¼ºåˆ¶ä½¿ç”¨æ—§ç‰ˆ Gradle | ä¸ SDK 34 ä¸å…¼å®¹ |
| å¯»æ‰¾æ´»è·ƒçš„ fork | æ²¡æ‰¾åˆ°ç»´æŠ¤ç‰ˆæœ¬ |

**æœ€ç»ˆå†³ç­–**ï¼šæ„å»ºåŸç”Ÿè§£å†³æ–¹æ¡ˆ

**å†³ç­–ç†ç”±**ï¼š
- åŸç”Ÿæ–¹æ¡ˆæ¯”ä½¿ç”¨åº“çš„ API æ›´èƒ½å±•ç¤º Android çŸ¥è¯†
- ç¬¦åˆ Tesla çš„"ç¬¬ä¸€æ€§åŸç†æ€ç»´"
- ä»£ç æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤

**å®ç°æ–¹æ¡ˆ**ï¼š
```kotlin
// ç®€å•ã€æœ‰æ•ˆã€æ˜“ç»´æŠ¤
private fun displayCategoryData(categoryTotals: Map<String, Double>) {
    categoryContainer.removeAllViews()
    
    val maxAmount = categoryTotals.values.maxOrNull() ?: 0.0
    val currencyFormat = NumberFormat.getCurrencyInstance(Locale.getDefault())
    
    categoryTotals.forEach { (category, amount) ->
        val itemView = layoutInflater.inflate(R.layout.item_chart_bar, categoryContainer, false)
        
        val tvCategory = itemView.findViewById<TextView>(R.id.tvLabel)
        val tvAmount = itemView.findViewById<TextView>(R.id.tvValue)
        val progressBar = itemView.findViewById<ProgressBar>(R.id.progressBar)
        
        tvCategory.text = category
        tvAmount.text = currencyFormat.format(amount)
        
        // å…³é”®åˆ›æ–°ï¼šä½¿ç”¨è¿›åº¦æ¡ä½œä¸ºå¯è§†åŒ–å±•ç¤º
        progressBar.max = 100
        progressBar.progress = if (maxAmount > 0) {
            ((amount / maxAmount) * 100).toInt()
        } else {
            0
        }
        
        categoryContainer.addView(itemView)
    }
}
```

**åŸç”Ÿæ–¹æ¡ˆçš„ä¼˜åŠ¿**ï¼š

| æŒ‡æ ‡ | ç¬¬ä¸‰æ–¹åº“ | åŸç”Ÿæ–¹æ¡ˆ |
|-----|---------|---------|
| APK ä½“ç§¯ | +2-3 MB | +0 MB |
| æ¸²æŸ“æ—¶é—´ | ~50-100ms | ~10-20ms |
| ä¾èµ–é£é™© | é«˜ï¼ˆç»´æŠ¤é—®é¢˜ï¼‰ | é›¶ |
| è‡ªå®šä¹‰èƒ½åŠ› | å—åº“é™åˆ¶ | å®Œå…¨æ§åˆ¶ |
| å­¦ä¹ ä»·å€¼ | åªæ˜¯è°ƒç”¨ API | æ·±å…¥ç†è§£ Android |

**æˆæœ**ï¼š
- 2 å°æ—¶å®ç° vs å¯èƒ½éœ€è¦æ•°å¤©è°ƒè¯•ä¾èµ–
- APK ä½“ç§¯å‡å°‘
- æ¸²æŸ“æ€§èƒ½æå‡
- é›¶æœªæ¥ç»´æŠ¤é£é™©

**å…³é”®ç»éªŒ**ï¼šæœ‰æ—¶æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ä¸è¦åœ¨ä¸å¿…è¦æ—¶å¢åŠ å¤æ‚æ€§ã€‚

---

### æŒ‘æˆ˜ 2ï¼šAndroid Activity ç”Ÿå‘½å‘¨æœŸ â­â­â­â­

**æˆ‘çš„çŸ¥è¯†ç›²åŒº**ï¼š

ä» iOS è½¬è¿‡æ¥ï¼Œæˆ‘æœ€åˆå¾ˆéš¾ç†è§£ Android ç”Ÿå‘½å‘¨æœŸçš„å¤æ‚æ€§ï¼š

```
iOS ViewControllerï¼š5 ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•
- viewDidLoad()
- viewWillAppear()
- viewDidAppear()
- viewWillDisappear()
- viewDidDisappear()

Android Activityï¼š11+ ä¸ªç”Ÿå‘½å‘¨æœŸå›è°ƒ
- onCreate()
- onStart()
- onResume()
- onPause()
- onStop()
- onDestroy()
- onSaveInstanceState()
- onRestoreInstanceState()
- onRestart()
- onUserLeaveHint()
- ç­‰ç­‰...
```

**å…³é”®é—®é¢˜**ï¼š

å±å¹•æ—‹è½¬ä¼šé”€æ¯å¹¶é‡å»º Activityï¼Œä¸¢å¤±æ‰€æœ‰ UI çŠ¶æ€ï¼š

```kotlin
// ä¿®å¤å‰ - æ—‹è½¬åæ•°æ®ä¸¢å¤±
class AddEditActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        // ç”¨æˆ·è¾“å…¥æ•°æ®
        // å±å¹•æ—‹è½¬
        // onCreate() å†æ¬¡è¢«è°ƒç”¨
        // æ‰€æœ‰æ•°æ®éƒ½æ²¡äº†
    }
}
```

**ç ”ç©¶å’Œå­¦ä¹ è¿‡ç¨‹**ï¼š
1. é˜…è¯» Android å¼€å‘è€…æŒ‡å—å…³äºé…ç½®å˜åŒ–çš„éƒ¨åˆ†
2. å­¦ä¹  ViewModel vs onSaveInstanceState çš„ä½¿ç”¨åœºæ™¯
3. åˆ†æå¼€æºåº”ç”¨ï¼ˆGitHub ä¸Šçƒ­é—¨çš„ Android åº”ç”¨ï¼‰
4. å°è¯•ä¸åŒçš„çŠ¶æ€ç®¡ç†æ–¹æ³•
5. â­åˆ›å»ºäº†è‡ªå·±çš„ç¨€åœŸæ˜é‡‘æŠ€æœ¯åšå®¢ï¼Œå·©å›ºå¢å¼ºåŸºç¡€çŸ¥è¯†ï¼šhttps://juejin.cn/user/4100551259985721

**è§£å†³æ–¹æ¡ˆå®ç°**ï¼š

```kotlin
class AddEditActivity : AppCompatActivity() {
    
    // æ­¥éª¤ 1ï¼šåœ¨é”€æ¯å‰ä¿å­˜çŠ¶æ€
    override fun onSaveInstanceState(outState: Bundle) {
        super.onSaveInstanceState(outState)
        Log.d(TAG, "åœ¨é”€æ¯å‰ä¿å­˜çŠ¶æ€")
        
        outState.apply {
            // ä¿å­˜æ‰€æœ‰è¡¨å•æ•°æ®
            putString(KEY_TITLE, etTitle.text.toString())
            putString(KEY_AMOUNT, etAmount.text.toString())
            putString(KEY_DESCRIPTION, etDescription.text.toString())
            putInt(KEY_CATEGORY_POSITION, spinnerCategory.selectedItemPosition)
            putLong(KEY_SELECTED_DATE, selectedDate.time)
            putBoolean(KEY_HAS_UNSAVED_CHANGES, hasUnsavedChanges)
        }
    }
    
    // æ­¥éª¤ 2ï¼šé‡å»ºåæ¢å¤çŠ¶æ€
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_add_edit)
        
        // æ¢å¤ä¿å­˜çš„çŠ¶æ€
        savedInstanceState?.let { bundle ->
            Log.d(TAG, "é‡å»ºåæ¢å¤çŠ¶æ€")
            etTitle.setText(bundle.getString(KEY_TITLE, ""))
            etAmount.setText(bundle.getString(KEY_AMOUNT, ""))
            etDescription.setText(bundle.getString(KEY_DESCRIPTION, ""))
            spinnerCategory.setSelection(bundle.getInt(KEY_CATEGORY_POSITION, 0))
            selectedDate = Date(bundle.getLong(KEY_SELECTED_DATE, System.currentTimeMillis()))
            hasUnsavedChanges = bundle.getBoolean(KEY_HAS_UNSAVED_CHANGES, false)
        }
    }
    
    // æ­¥éª¤ 3ï¼šæ•°æ®ä¸¢å¤±å‰è­¦å‘Šç”¨æˆ·
    override fun onBackPressed() {
        checkForUnsavedChanges()
        
        if (hasUnsavedChanges) {
            AlertDialog.Builder(this)
                .setTitle("æœªä¿å­˜çš„æ›´æ”¹")
                .setMessage("æ˜¯å¦åœ¨ç¦»å¼€å‰ä¿å­˜ï¼Ÿ")
                .setPositiveButton("ä¿å­˜") { _, _ -> saveExpense() }
                .setNegativeButton("æ”¾å¼ƒ") { _, _ -> finish() }
                .setNeutralButton("å–æ¶ˆ", null)
                .show()
        } else {
            super.onBackPressed()
        }
    }
}
```

**é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸå¤„ç†**ï¼š

```kotlin
// è·Ÿè¸ª activity å¯è§æ€§ä»¥å®‰å…¨æ“ä½œ UI
class MainActivity : AppCompatActivity() {
    private var isActivityVisible = false
    
    override fun onResume() {
        super.onResume()
        isActivityVisible = true
        refreshDataIfNeeded()
    }
    
    override fun onPause() {
        super.onPause()
        isActivityVisible = false
        // ä¿å­˜æ»šåŠ¨ä½ç½®ã€å–æ¶ˆå¯¹è¯æ¡†ç­‰
    }
    
    // é˜²æ­¢åœ¨ activity ä¸å¯è§æ—¶æ˜¾ç¤ºå¯¹è¯æ¡†
    private fun showDeleteDialog(expense: Expense) {
        if (!isActivityVisible) {
            Log.w(TAG, "å°è¯•åœ¨ activity ä¸å¯è§æ—¶æ˜¾ç¤ºå¯¹è¯æ¡†")
            return
        }
        // å®‰å…¨åœ°æ˜¾ç¤ºå¯¹è¯æ¡†
    }
}
```

**æµ‹è¯•è¦†ç›–**ï¼š

æˆ‘è¿›è¡Œäº†å¹¿æ³›æµ‹è¯•ï¼š
- å±å¹•æ—‹è½¬ï¼ˆç«–å± â†” æ¨ªå±ï¼‰
- åº”ç”¨åå°ï¼ˆæŒ‰ Home é”®ï¼‰
- å¤šçª—å£æ¨¡å¼
- ä½å†…å­˜æƒ…å†µï¼ˆæ¨¡æ‹Ÿï¼‰
- é…ç½®å˜åŒ–ï¼ˆè¯­è¨€ã€å­—ä½“å¤§å°ï¼‰

**æˆæœ**ï¼š
- é›¶æ•°æ®ä¸¢å¤±åœºæ™¯
- æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¸­æµç•…çš„ç”¨æˆ·ä½“éªŒ
- æ·±å…¥ç†è§£ Android çš„å†…å­˜ç®¡ç†

**å…³é”®ç»éªŒ**ï¼šAndroid ç”Ÿå‘½å‘¨æœŸçš„å¤æ‚æ€§æ˜¯æœ‰å……åˆ†ç†ç”±çš„â€”â€”è®¾å¤‡å¤šæ ·æ€§ã€å†…å­˜é™åˆ¶å’Œå¤šä»»åŠ¡å¤„ç†ã€‚ä¸€æ—¦ç†è§£ï¼Œå®ƒå®é™…ä¸Šæ¯” iOS æ›´ç®€å•çš„æ¨¡å‹æ›´å¼ºå¤§ã€‚

---

### æŒ‘æˆ˜ 3ï¼šæƒé™ç®¡ç†ï¼ˆAndroid 13+ï¼‰â­â­â­

**æ„å¤–æƒ…å†µ**ï¼š

æˆ‘çš„å‰å°æœåŠ¡åœ¨æˆ‘çš„æµ‹è¯•è®¾å¤‡ï¼ˆAndroid 11ï¼‰ä¸Šè¿è¡Œè‰¯å¥½ï¼Œä½†åœ¨ Android 13+ æ¨¡æ‹Ÿå™¨ä¸Šå´©æºƒï¼š

```
FATAL EXCEPTION: main
SecurityException: Starting FGS with type dataSync 
callerApp=ProcessRecord requires permission
```

**æ ¹æœ¬åŸå› **ï¼š

Android 13 å¼•å…¥äº†è¿è¡Œæ—¶é€šçŸ¥æƒé™ï¼ˆä¹‹å‰ä¸å­˜åœ¨ï¼‰ï¼š

```kotlin
// Android 12 åŠä»¥ä¸‹ - è‡ªåŠ¨å·¥ä½œ
startForeground(NOTIFICATION_ID, notification)

// Android 13+ - éœ€è¦æ˜¾å¼è¯·æ±‚æƒé™
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
    if (ContextCompat.checkSelfPermission(
            this,
            Manifest.permission.POST_NOTIFICATIONS
        ) != PackageManager.PERMISSION_GRANTED
    ) {
        // å¿…é¡»åœ¨è¿è¡Œæ—¶è¯·æ±‚æƒé™ï¼
        ActivityCompat.requestPermissions(
            this,
            arrayOf(Manifest.permission.POST_NOTIFICATIONS),
            NOTIFICATION_PERMISSION_REQUEST
        )
    }
}
```

**å‘åå…¼å®¹è§£å†³æ–¹æ¡ˆ**ï¼š

```kotlin
class ExpenseService : Service() {
    
    private fun hasRequiredPermissions(): Boolean {
        // æ£€æŸ¥å‰å°æœåŠ¡æƒé™
        val foregroundServicePermission = ContextCompat.checkSelfPermission(
            this, 
            android.Manifest.permission.FOREGROUND_SERVICE
        ) == PackageManager.PERMISSION_GRANTED
        
        // æ£€æŸ¥æ•°æ®åŒæ­¥æƒé™ï¼ˆAndroid 14+ï¼‰
        val dataSyncPermission = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.UPSIDE_DOWN_CAKE) {
            ContextCompat.checkSelfPermission(
                this, 
                android.Manifest.permission.FOREGROUND_SERVICE_DATA_SYNC
            ) == PackageManager.PERMISSION_GRANTED
        } else {
            true  // æ—§ç‰ˆæœ¬ä¸éœ€è¦
        }
        
        Log.d(TAG, "æƒé™ - å‰å°æœåŠ¡: $foregroundServicePermission, æ•°æ®åŒæ­¥: $dataSyncPermission")
        return foregroundServicePermission && dataSyncPermission
    }
    
    override fun onCreate() {
        super.onCreate()
        
        // ä¼˜é›…é™çº§
        if (hasRequiredPermissions()) {
            try {
                startForeground(NOTIFICATION_ID, createNotification())
                Log.d(TAG, "å‰å°æœåŠ¡å¯åŠ¨æˆåŠŸ")
            } catch (e: SecurityException) {
                Log.e(TAG, "å¯åŠ¨å‰å°æœåŠ¡å¤±è´¥", e)
                stopSelf()  // å¦‚æœæ— æ³•æ­£å¸¸è¿è¡Œå°±åœæ­¢æœåŠ¡
            }
        } else {
            Log.w(TAG, "ç¼ºå°‘å¿…éœ€æƒé™")
            stopSelf()
        }
    }
}
```

**æµ‹è¯•çŸ©é˜µ**ï¼š

| Android ç‰ˆæœ¬ | æ‰€éœ€æƒé™ | æµ‹è¯•ç»“æœ |
|------------|---------|---------|
| Android 7.0 (API 24) | FOREGROUND_SERVICE | é€šè¿‡ |
| Android 11 (API 30) | FOREGROUND_SERVICE | é€šè¿‡ |
| Android 13 (API 33) | + POST_NOTIFICATIONS | é€šè¿‡ |
| Android 14 (API 34) | + FOREGROUND_SERVICE_DATA_SYNC | é€šè¿‡ |

**å…³é”®ç»éªŒ**ï¼šAndroid ç¢ç‰‡åŒ–æ˜¯çœŸå®å­˜åœ¨çš„ã€‚å§‹ç»ˆåœ¨å¤šä¸ª API çº§åˆ«ä¸Šæµ‹è¯•ï¼Œå¹¶é€šè¿‡ä¼˜é›…é™çº§æ¥é˜²å¾¡æ€§åœ°å¤„ç†æƒé™ã€‚

---

## 4. iOS åˆ° Android çš„è¿ç§»ä¹‹æ—…

### 4.1 æ¦‚å¿µæ˜ å°„

**æˆåŠŸè¿ç§»çš„æ¦‚å¿µ**ï¼š

| iOS æ¦‚å¿µ | Android å¯¹åº”æ¦‚å¿µ | è¿ç§»éš¾åº¦ | å¤‡æ³¨ |
|---------|----------------|---------|------|
| **SwiftUI** | XML Layouts + ViewBinding | â­â­â­ | ä»å£°æ˜å¼åˆ°å‘½ä»¤å¼çš„æ€ç»´è½¬å˜ |
| **Core Data** | Room Database | â­â­ | å®é™…ä¸Šæ›´ç®€å•ï¼Room æ›´ç›´è§‚ |
| **Combine** | LiveData + Flow | â­â­ | å“åº”å¼æ¦‚å¿µç›¸ä¼¼ |
| **ViewController** | Activity | â­â­â­â­ | ç”Ÿå‘½å‘¨æœŸå¤æ‚å¾—å¤š |
| **Background Tasks** | Service/WorkManager | â­â­â­â­ | é™åˆ¶æ›´å¤šï¼Œå¤æ‚åº¦æ›´é«˜ |

### 4.2 ä¸»è¦æ€ç»´è½¬å˜

#### è½¬å˜ 1ï¼šé…ç½®å˜åŒ–

**iOS**ï¼š
```swift
// å±å¹•æ—‹è½¬è§†å›¾è‡ªåŠ¨è°ƒæ•´
override func viewWillTransition(to size: CGSize, 
                                  with coordinator: UIViewControllerTransitionCoordinator) {
    super.viewWillTransition(to: size, with: coordinator)
    // è°ƒæ•´å¸ƒå±€
}
```

**Android**ï¼š
```kotlin
// å±å¹•æ—‹è½¬Activity æ­»äº†åˆé‡ç”Ÿ
// å¿…é¡»æ‰‹åŠ¨ä¿å­˜æ‰€æœ‰çŠ¶æ€
override fun onSaveInstanceState(outState: Bundle) {
    super.onSaveInstanceState(outState)
    // ä¿å­˜æ‰€æœ‰ä¸œè¥¿ï¼Œå¦åˆ™æ°¸è¿œä¸¢å¤±
}
```

**ä¸ºä»€ä¹ˆå­˜åœ¨è¿™ä¸ªæœºåˆ¶**ï¼šAndroid è®¾å¤‡å†…å­˜æœ‰é™ã€ç”µæ± ä¼˜åŒ–æ¿€è¿›ã€ç¡¬ä»¶å¤šæ ·ã€‚æ€æ­» activities å¯ä»¥é‡Šæ”¾èµ„æºã€‚

#### è½¬å˜ 2ï¼šæƒé™ç³»ç»Ÿ

**iOS Info.plist**ï¼š
```xml
<!-- ä¸€æ¬¡æ€§å£°æ˜ -->
<key>NSCameraUsageDescription</key>
<string>æˆ‘ä»¬éœ€è¦ç›¸æœºæƒé™</string>
```

**Android**ï¼š
```kotlin
// éœ€è¦è¿è¡Œæ—¶åŠ¨æ€è¯·æ±‚æƒé™ï¼
if (ContextCompat.checkSelfPermission(this, permission) != PERMISSION_GRANTED) {
    ActivityCompat.requestPermissions(this, arrayOf(permission), REQUEST_CODE)
}

// å¤„ç†å“åº”
override fun onRequestPermissionsResult(...) {
    // æ£€æŸ¥æ˜¯å¦æˆäºˆ
}
```

**è€Œä¸”**ï¼šä¸åŒ Android ç‰ˆæœ¬çš„æƒé™è¦æ±‚ä¸åŒï¼

### 4.3 å› ä¸º iOS ç»éªŒå­¦å¾—æ›´å¿«çš„å†…å®¹

**æ¶æ„æ¨¡å¼**ï¼šiOS MVC/MVVM ç»éªŒç›´æ¥åº”ç”¨
**å¼‚æ­¥ç¼–ç¨‹**ï¼šGCD â†’ åç¨‹è½¬æ¢å¾ˆé¡ºåˆ©
**æ•°æ®åº“æ¦‚å¿µ**ï¼šCore Data â†’ Room æ˜ å°„å¾ˆç›´è§‚
**UI æ€ç»´**ï¼šç»„ä»¶ç»„åˆæ€ç»´è¿ç§»è‰¯å¥½

### 4.4 Android è®©æˆ‘æƒŠè®¶çš„åœ°æ–¹

**å¥½çš„æ–¹é¢**ï¼š
- Room æ¯” Core Data æ›´ç®€æ´
- Kotlin åœ¨æŸäº›æ–¹é¢æ¯” Swift æ›´æœ‰è¡¨ç°åŠ›ï¼Œæœ‰javaåŸºç¡€æ›´ç®€å•
- Material Design ç»„ä»¶å¾ˆæ£’
- Gradle å¾ˆå¼º

**æœ‰æŒ‘æˆ˜çš„æ–¹é¢**ï¼š
- ç”Ÿå‘½å‘¨æœŸå¤æ‚æ€§ï¼ˆèŠ±äº† 3 å¤©æ‰å®Œå…¨æŒæ¡ï¼‰
- XML å¸ƒå±€å†—é•¿ vs SwiftUI ç®€æ´
- ä¾èµ–ç®¡ç†é—®é¢˜ï¼ˆå›¾è¡¨åº“çš„æ•…äº‹ï¼‰
- Android ç‰ˆæœ¬é—´çš„ç¢ç‰‡åŒ–

### 4.5 æˆ‘ä½¿ç”¨çš„å­¦ä¹ èµ„æº

**å®˜æ–¹æ–‡æ¡£**ï¼š
- Android å¼€å‘è€…æŒ‡å—ï¼ˆä¸»è¦èµ„æºï¼‰
- Kotlin æ–‡æ¡£
- Material Design æŒ‡å—

**ç¤¾åŒºèµ„æº**ï¼š
- Stack Overflowï¼ˆè§£å†³å…·ä½“é”™è¯¯ï¼‰
- GitHubï¼ˆç ”ç©¶å¼€æº Android åº”ç”¨ï¼‰
- YouTubeï¼ˆPhilipp Lackner çš„ Android æ•™ç¨‹ï¼‰
- ã€Šç¬¬ä¸€è¡Œä»£ç Androidã€‹

---

## 5. ä»£ç è´¨é‡ä¸æµ‹è¯•

### 5.1 ä»£ç ç»„ç»‡

**åŒ…ç»“æ„**ï¼š
```
com.example.expensetracker/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ Expense.kt          (å®ä½“)
â”‚   â”‚   â”œâ”€â”€ ExpenseDao.kt       (æ•°æ®è®¿é—®å¯¹è±¡)
â”‚   â”‚   â”œâ”€â”€ ExpenseDatabase.kt  (æ•°æ®åº“å•ä¾‹)
â”‚   â”‚   â””â”€â”€ Converters.kt       (ç±»å‹è½¬æ¢å™¨)
â”‚   â””â”€â”€ repository/
â”‚       â””â”€â”€ ExpenseRepository.kt (æ•°æ®æŠ½è±¡å±‚)
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ MainActivity.kt
â”‚   â”‚   â”œâ”€â”€ MainViewModel.kt
â”‚   â”‚   â”œâ”€â”€ MainViewModelFactory.kt
â”‚   â”‚   â””â”€â”€ ExpenseAdapter.kt
â”‚   â”œâ”€â”€ addedit/
â”‚   â”‚   â”œâ”€â”€ AddEditActivity.kt
â”‚   â”‚   â”œâ”€â”€ AddEditViewModel.kt
â”‚   â”‚   â””â”€â”€ AddEditViewModelFactory.kt
â”‚   â””â”€â”€ chart/
â”‚       â”œâ”€â”€ ChartActivity.kt
â”‚       â”œâ”€â”€ ChartViewModel.kt
â”‚       â””â”€â”€ ChartViewModelFactory.kt
â”œâ”€â”€ service/
â”‚   â””â”€â”€ ExpenseService.kt       (åå°æœåŠ¡)
â””â”€â”€ utils/
    â””â”€â”€ DateUtils.kt            (è¾…åŠ©å‡½æ•°)
```

**è®¾è®¡ç†ç”±**ï¼š
- æŒ‰åŠŸèƒ½æ¸…æ™°åˆ†ç¦»ï¼ˆmainã€addeditã€chartï¼‰
- æ•°æ®å±‚ä¸ UI éš”ç¦»
- æ˜“äºå®šä½ä»»ä½•ç»„ä»¶
- å¯¹æœªæ¥åŠŸèƒ½æ‰©å±•å‹å¥½

### 5.2 å‘½åè§„èŒƒ

**å˜é‡**ï¼š
```kotlin
// æ¸…æ™°ã€æè¿°æ€§çš„åç§°
private lateinit var expenseAdapter: ExpenseAdapter  // ä¸æ˜¯ "adapter"
private var selectedDate: Date = Date()  // ä¸æ˜¯ "date" æˆ– "d"
private var hasUnsavedChanges: Boolean = false  // ä¸æ˜¯ "changed"
```

**å‡½æ•°**ï¼š
```kotlin
// åŠ¨ä½œç”¨åŠ¨è¯
fun saveExpense() { }
fun deleteExpense(expense: Expense) { }
fun updateDateDisplay() { }

// å¸ƒå°”å€¼ getter ç”¨ "is" æˆ– "has"
fun isValidExpense(expense: Expense): Boolean
fun hasRequiredPermissions(): Boolean
```

### 5.3 æ³¨é‡Šä¸æ–‡æ¡£

**ä»€ä¹ˆæ—¶å€™å†™æ³¨é‡Š**ï¼š

```kotlin
// ä¸å¥½ï¼šé™ˆè¿°æ˜¾è€Œæ˜“è§çš„äº‹
val total = expenses.sumOf { it.amount }  // è®¡ç®—æ€»å’Œ

// è§£é‡Šä¸ºä»€ä¹ˆæˆ–éæ˜¾è€Œæ˜“è§çš„è¡Œä¸º
// ä½¿ç”¨ LiveData å®ç°æ•°æ®åº“å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–° UI
val allExpenses: LiveData<List<Expense>> = repository.getAllExpenses()

// è®°å½•å¤æ‚ç®—æ³•
/**
 * æ¨¡æ‹Ÿè‡ªåŠ¨è´¹ç”¨æ£€æµ‹ï¼Œä½¿ç”¨çœŸå®æ¦‚ç‡ã€‚
 * 
 * ä½¿ç”¨ 50% çš„æ¦‚ç‡æ¥å¹³è¡¡æ¼”ç¤ºé¢‘ç‡å’ŒçœŸå®æ€§ã€‚
 * åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™å°†è§£æå®é™…çš„ SMS æ¶ˆæ¯ã€‚
 */
private fun simulateAutomaticExpense() { }
```

### 5.4 é”™è¯¯å¤„ç†

**å¤šå±‚é˜²å¾¡æ€§ç¼–ç¨‹**ï¼š

```kotlin
// ç¬¬ 1 å±‚ï¼šè¾“å…¥éªŒè¯
fun saveExpense() {
    val title = etTitle.text.toString().trim()
    
    if (title.isEmpty()) {
        etTitle.error = "æ ‡é¢˜ä¸èƒ½ä¸ºç©º"
        etTitle.requestFocus()
        return
    }
    
    val amount = try {
        etAmount.text.toString().toDouble()
    } catch (e: NumberFormatException) {
        etAmount.error = "é‡‘é¢æ— æ•ˆ"
        etAmount.requestFocus()
        return
    }
    
    if (amount <= 0) {
        etAmount.error = "é‡‘é¢å¿…é¡»å¤§äº 0"
        etAmount.requestFocus()
        return
    }
    
    // ç»§ç»­ä¿å­˜
}

// ç¬¬ 2 å±‚ï¼šæ•°æ®åº“æ“ä½œ
lifecycleScope.launch {
    try {
        repository.insertExpense(expense)
        Toast.makeText(this@AddEditActivity, "è´¹ç”¨å·²ä¿å­˜", Toast.LENGTH_SHORT).show()
        setResult(RESULT_OK)
        finish()
    } catch (e: Exception) {
        Log.e(TAG, "ä¿å­˜è´¹ç”¨å‡ºé”™", e)
        Toast.makeText(
            this@AddEditActivity, 
            "ä¿å­˜è´¹ç”¨å‡ºé”™: ${e.message}", 
            Toast.LENGTH_LONG
        ).show()
        btnSave.isEnabled = true  // é‡æ–°å¯ç”¨æŒ‰é’®
    }
}

// ç¬¬ 3 å±‚ï¼šæƒé™æ£€æŸ¥
private fun startExpenseService() {
    if (hasRequiredPermissions()) {
        startService(Intent(this, ExpenseService::class.java))
    } else {
        Log.w(TAG, "æ— æ³•å¯åŠ¨æœåŠ¡ - ç¼ºå°‘æƒé™")
        Toast.makeText(
            this, 
            "åå°æœåŠ¡éœ€è¦é€šçŸ¥æƒé™", 
            Toast.LENGTH_LONG
        ).show()
    }
}
```

### 5.5 çº¿ç¨‹ä¸å¹¶å‘

**æ­£ç¡®çš„çº¿ç¨‹ç®¡ç†**ï¼š

```kotlin
class MainViewModel(private val repository: ExpenseRepository) : ViewModel() {
    
    // UI å®‰å…¨ï¼šLiveData è‡ªåŠ¨åœ¨ä¸»çº¿ç¨‹æ›´æ–°
    val allExpenses: LiveData<List<Expense>> = repository.getAllExpenses()
    
    // åå°å·¥ä½œï¼šä» viewModelScope è°ƒç”¨ suspend å‡½æ•°
    suspend fun getTotalAmount(): Double {
        return withContext(Dispatchers.IO) {
            repository.getTotalAmount()
        }
    }
    
    // åç¨‹ä½œç”¨åŸŸç»‘å®šåˆ° ViewModel ç”Ÿå‘½å‘¨æœŸ
    fun deleteExpense(expense: Expense) {
        viewModelScope.launch {  // ViewModel é”€æ¯æ—¶è‡ªåŠ¨å–æ¶ˆ
            repository.deleteExpense(expense)
        }
    }
}
```

### 5.6 å•å…ƒæµ‹è¯•

**æµ‹è¯•è¦†ç›–**ï¼š

```kotlin
@Test
fun testExpenseValidation() {
    // æœ‰æ•ˆè´¹ç”¨
    val validExpense = Expense(
        title = "æµ‹è¯•",
        amount = 50.0,
        category = "é£Ÿç‰©",
        date = Date()
    )
    assertTrue("æœ‰æ•ˆè´¹ç”¨åº”è¯¥é€šè¿‡", isValidExpense(validExpense))
    
    // æ— æ•ˆï¼šç©ºæ ‡é¢˜
    val invalidTitle = validExpense.copy(title = "")
    assertFalse("ç©ºæ ‡é¢˜åº”è¯¥å¤±è´¥", isValidExpense(invalidTitle))
    
    // æ— æ•ˆï¼šè´Ÿé‡‘é¢
    val negativeAmount = validExpense.copy(amount = -10.0)
    assertFalse("è´Ÿé‡‘é¢åº”è¯¥å¤±è´¥", isValidExpense(negativeAmount))
    
    // æ— æ•ˆï¼šé›¶é‡‘é¢
    val zeroAmount = validExpense.copy(amount = 0.0)
    assertFalse("é›¶é‡‘é¢åº”è¯¥å¤±è´¥", isValidExpense(zeroAmount))
    
    // è¾¹ç•Œï¼šæœ€å°æœ‰æ•ˆé‡‘é¢
    val minimumAmount = validExpense.copy(amount = 0.01)
    assertTrue("æœ€å°æœ‰æ•ˆé‡‘é¢åº”è¯¥é€šè¿‡", isValidExpense(minimumAmount))
}

@Test
fun testExpenseCalculations() {
    val expenses = listOf(
        Expense(1, "E1", 25.50, "é£Ÿç‰©", Date()),
        Expense(2, "E2", 15.75, "äº¤é€š", Date()),
        Expense(3, "E3", 100.00, "è´­ç‰©", Date())
    )
    
    val total = calculateTotal(expenses)
    assertEquals("æ€»è®¡åº”è¯¥æ˜¯ 141.25", 141.25, total, 0.01)
    
    // è¾¹ç•Œæƒ…å†µï¼šç©ºåˆ—è¡¨
    assertEquals("ç©ºåˆ—è¡¨æ€»è®¡åº”è¯¥æ˜¯ 0", 0.0, calculateTotal(emptyList()), 0.01)
}

@Test
fun testCategoryGrouping() {
    val expenses = listOf(
        Expense(1, "å’–å•¡", 4.50, "é£Ÿç‰©", Date()),
        Expense(2, "åˆé¤", 12.99, "é£Ÿç‰©", Date()),
        Expense(3, "å…¬äº¤", 2.50, "äº¤é€š", Date()),
        Expense(4, "æ™šé¤", 18.75, "é£Ÿç‰©", Date())
    )
    
    val grouped = groupByCategory(expenses)
    
    assertEquals("é£Ÿç‰©ç±»åˆ«æ€»è®¡", 36.24, grouped["é£Ÿç‰©"] ?: 0.0, 0.01)
    assertEquals("äº¤é€šç±»åˆ«æ€»è®¡", 2.50, grouped["äº¤é€š"] ?: 0.0, 0.01)
    assertEquals("ç±»åˆ«æ•°é‡", 2, grouped.size)
}
```

**æµ‹è¯•ç»Ÿè®¡**ï¼š
- æ€»æµ‹è¯•ç”¨ä¾‹ï¼š12 ä¸ª
- è¦†ç›–çš„è¾¹ç•Œæƒ…å†µï¼šç©ºåˆ—è¡¨ã€å•é¡¹ã€è¾¹ç•Œå€¼
- è®¡ç®—ç²¾åº¦ï¼š0.01 ç²¾åº¦éªŒè¯
- æ—¥æœŸå¤„ç†ï¼šæµ‹è¯•å¤šç§åœºæ™¯

---

## 6. è¿è¡Œè¯´æ˜

### 6.1 å‰ç½®è¦æ±‚

- **Android Studio**ï¼šHedgehog (2023.1.1) æˆ–æ›´é«˜ç‰ˆæœ¬
- **JDK**ï¼šJava 11 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Android SDK**ï¼šæœ€ä½ API 24ï¼ˆAndroid 7.0ï¼‰
- **ç›®æ ‡ SDK**ï¼šAPI 34ï¼ˆAndroid 14ï¼‰
- **Gradle**ï¼š8.0+

### 6.2 å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**ï¼š
```bash
git clone https://github.com/ANTI-Tony/Expense_Tracker.git
cd Expense_Tracker
```

2. **åœ¨ Android Studio ä¸­æ‰“å¼€**ï¼š
- å¯åŠ¨ Android Studio
- é€‰æ‹© "Open an Existing Project"
- å¯¼èˆªåˆ°å…‹éš†çš„ç›®å½•
- ç‚¹å‡» "Open"

3. **åŒæ­¥ Gradle**ï¼š
- Android Studio ä¼šè‡ªåŠ¨æ£€æµ‹ `build.gradle.kts`
- å¦‚æœæç¤ºï¼Œç‚¹å‡» "Sync Now"
- ç­‰å¾…ä¾èµ–è§£æï¼ˆé¦–æ¬¡å¯èƒ½éœ€è¦ 2-3 åˆ†é’Ÿï¼‰

4. **é…ç½® SDK**ï¼š
- è¿›å…¥ Tools â†’ SDK Manager
- ç¡®ä¿å·²å®‰è£… Android 7.0ï¼ˆAPI 24ï¼‰åˆ° Android 14ï¼ˆAPI 34ï¼‰
- å¦‚æœæç¤ºï¼Œå®‰è£…ç¼ºå¤±çš„ SDK ç»„ä»¶

5. **æ„å»ºé¡¹ç›®**ï¼š
```bash
./gradlew build
```

### 6.3 è¿è¡Œåº”ç”¨

**åœ¨çœŸæœºä¸Š**ï¼š
1. åœ¨ Android è®¾å¤‡ä¸Šå¯ç”¨å¼€å‘è€…é€‰é¡¹
2. å¯ç”¨ USB è°ƒè¯•
3. é€šè¿‡ USB è¿æ¥è®¾å¤‡
4. åœ¨ Android Studio ä¸­ç‚¹å‡» "Run"ï¼ˆç»¿è‰²æ’­æ”¾æŒ‰é’®ï¼‰
5. ä»åˆ—è¡¨ä¸­é€‰æ‹©ä½ çš„è®¾å¤‡

**åœ¨æ¨¡æ‹Ÿå™¨ä¸Š**ï¼š
1. åœ¨ Android Studio ä¸­ç‚¹å‡» "Device Manager"
2. åˆ›å»ºæ–°çš„è™šæ‹Ÿè®¾å¤‡ï¼ˆæ¨è Pixel 5ï¼ŒAPI 33ï¼‰
3. å¯åŠ¨æ¨¡æ‹Ÿå™¨
4. ç‚¹å‡» "Run" å¹¶é€‰æ‹©æ¨¡æ‹Ÿå™¨

### 6.4 æµ‹è¯•

**è¿è¡Œå•å…ƒæµ‹è¯•**ï¼š
```bash
./gradlew test
```

**åœ¨ Android Studio ä¸­è¿è¡Œ**ï¼š
- å³é”®ç‚¹å‡» `app/src/test/java`
- é€‰æ‹© "Run 'All Tests'"

---

## 7. æœªæ¥æ”¹è¿›æ–¹å‘

### 7.1 å³æ—¶æ”¹è¿›

**1. Jetpack Compose è¿ç§»**

å½“å‰é™åˆ¶ï¼šXML å¸ƒå±€å†—é•¿

å»ºè®®çš„ Compose ç‰ˆæœ¬ï¼š
```kotlin
@Composable
fun ExpenseItem(expense: Expense, onClick: () -> Unit) {
    Card(modifier = Modifier.clickable(onClick = onClick)) {
        Column {
            Text(expense.title, style = MaterialTheme.typography.h6)
            Text("$${expense.amount}", color = Color.Red)
            Text(expense.category, style = MaterialTheme.typography.caption)
        }
    }
}
// 10 è¡Œ vs 50+ è¡Œ XML
```

**2. Hilt ä¾èµ–æ³¨å…¥**

å½“å‰ï¼šåˆ°å¤„æ‰‹åŠ¨åˆå§‹åŒ– repository

ä½¿ç”¨ Hiltï¼š
```kotlin
@HiltAndroidApp
class ExpenseTrackerApp : Application()

@AndroidEntryPoint
class MainActivity : AppCompatActivity() {
    @Inject lateinit var repository: ExpenseRepository  // è‡ªåŠ¨æ³¨å…¥
}
```

**3. Navigation Component**

æ›¿æ¢å·²åºŸå¼ƒçš„ `startActivityForResult`ï¼š
```kotlin
// å½“å‰ï¼ˆAPI 30 ä¸­å·²åºŸå¼ƒï¼‰
startActivityForResult(intent, REQUEST_ADD_EDIT)

// ç°ä»£ Navigation Component
findNavController().navigate(
    MainFragmentDirections.actionMainToAddEdit(expense)
)
```

### 7.2 åŠŸèƒ½æ‰©å±•

**1. Firebase äº‘åŒæ­¥**
```
æœ¬åœ° Room æ•°æ®åº“ â†â†’ Firebase Firestore
                â†“
          å¤šè®¾å¤‡åŒæ­¥
```

**2. é¢„ç®—ç®¡ç†**
```kotlin
data class Budget(
    val category: String,
    val limit: Double,
    val period: Period  // DAILY, WEEKLY, MONTHLY
)

// è¾¾åˆ°é¢„ç®— 80% æ—¶è­¦å‘Š
if (spent > budget.limit * 0.8) {
    showBudgetWarning()
}
```

**3. æ”¶æ®æ‰«æï¼ˆML Kitï¼‰**
```kotlin
val recognizer = TextRecognition.getClient()
recognizer.process(receiptImage)
    .addOnSuccessListener { visionText ->
        val amount = extractAmount(visionText.text)
        val merchant = extractMerchant(visionText.text)
        // é¢„å¡«è´¹ç”¨è¡¨å•
    }
```

### 7.3 æŠ€æœ¯å€ºåŠ¡æ¸…ç†

| é¡¹ç›® | ä¼˜å…ˆçº§ |
|-----|--------|
| æ·»åŠ  UI æµ‹è¯•ï¼ˆEspressoï¼‰ | é«˜ |
| å®ç°æ•°æ®åº“è¿ç§» | é«˜ |
| ProGuard/R8 ä¼˜åŒ– | ä¸­ |
| æ— éšœç¢æ”¹è¿› | ä¸­ |
| æ€§èƒ½åˆ†æ | ä½ |
| ä»£ç è¦†ç›–ç‡ >80% | ä½ |

---

## 8. è‡ªæˆ‘è¯„ä¼°ä¸åæ€

### 8.1 åšå¾—å¥½çš„åœ°æ–¹

**æŠ€æœ¯æˆå°±**ï¼š
1. **å¿«é€Ÿå­¦ä¹ æ›²çº¿**ï¼š4 å‘¨ä» 0 Android çŸ¥è¯†åˆ°åŠŸèƒ½å®Œæ•´çš„åº”ç”¨
2. **æ¸…æ™°æ¶æ„**ï¼šå®Œæ•´çš„ MVVM å®ç°
3. **é—®é¢˜è§£å†³**ï¼šå›¾è¡¨åº“é—®é¢˜ â†’ åˆ›æ–°çš„åŸç”Ÿè§£å†³æ–¹æ¡ˆ
4. **ç”Ÿå‘½å‘¨æœŸç²¾é€š**ï¼šå…¨é¢çš„çŠ¶æ€ç®¡ç†ï¼Œæ— æ•°æ®ä¸¢å¤±
5. **æµ‹è¯•**ï¼šæœ‰æ„ä¹‰çš„å•å…ƒæµ‹è¯•ï¼Œä¸åªæ˜¯ç¤ºä¾‹

**è½¯æŠ€èƒ½**ï¼š
1. **è‡ªå­¦èƒ½åŠ›**ï¼šä¼˜å…ˆä½¿ç”¨ Android æ–‡æ¡£ï¼Œå¡ä½æ—¶æ‰ç”¨ Stack Overflow å’Œ GenAI
2. **æ—¶é—´ç®¡ç†**ï¼šå°½ç®¡æœ‰ä¾èµ–é—®é¢˜ï¼Œä»äº¤ä»˜äº†æ‰€æœ‰åŠŸèƒ½
3. **æ–‡æ¡£**ï¼šæ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¿æŒè¯¦ç»†è®°å½•
4. **é€‚åº”èƒ½åŠ›**ï¼šéœ€è¦æ—¶ä»ç¬¬ä¸‰æ–¹æ–¹æ¡ˆè½¬å‘åŸç”Ÿæ–¹æ¡ˆ

### 8.2 å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ 

**æŠ€æœ¯å·®è·**ï¼š
1. **æµ‹è¯•è¦†ç›–**ï¼šåªæœ‰å•å…ƒæµ‹è¯•ï¼Œç¼ºå°‘é›†æˆå’Œ å®Œæ•´ UI æµ‹è¯•
2. **ä¾èµ–æ³¨å…¥**ï¼šæ‰‹åŠ¨ DI å®¹æ˜“å‡ºé”™ï¼Œåº”è¯¥ä½¿ç”¨ Hilt
3. **ç¡¬ç¼–ç å­—ç¬¦ä¸²**ï¼šä¸€äº›å­—ç¬¦ä¸²æ²¡åœ¨èµ„æºä¸­ï¼ˆä¸åˆ©äºå›½é™…åŒ–ï¼‰
4. **é­”æ³•æ•°å­—**ï¼šåº”è¯¥æå–å¸¸é‡ï¼ˆä¾‹å¦‚ï¼Œ30000L â†’ INTERVAL_MSï¼‰

**å­¦ä¹ é¢†åŸŸ**ï¼š
1. **Jetpack Compose**ï¼šç°ä»£ UI æ¡†æ¶
2. **WorkManager**ï¼šæ¯” Service æ›´é€‚åˆåå°ä»»åŠ¡
3. **Kotlin Flow**ï¼šå¯¹äºå¤æ‚åœºæ™¯æ¯” LiveData æ›´å¼ºå¤§
4. **Navigation Component**ï¼šç°ä»£å¯¼èˆª vs æ—§çš„ Intent ç³»ç»Ÿ

### 8.3 å¦‚æœé‡æ–°å¼€å§‹

1. **ä»ç¬¬ä¸€å¤©å°±ç”¨ Compose**ï¼šç°åœ¨ç†è§£ Android äº†ï¼ŒCompose ä¼šæ›´å®¹æ˜“
2. **æµ‹è¯•é©±åŠ¨å¼€å‘**ï¼šå…ˆå†™æµ‹è¯•ä¼šæ”¹å–„æ¶æ„
3. **ç”¨ WorkManager è€Œä¸æ˜¯ Service**ï¼šæ›´çœç”µä¸”æ˜“ç»´æŠ¤
4. **æå‰ç ”ç©¶ä¾èµ–**ï¼šä¼šåœ¨å›¾è¡¨åº“ä¸ŠèŠ‚çœæ—¶é—´

### 8.4 å…³é”®å­¦ä¹ 

**æŠ€æœ¯æ´å¯Ÿ**ï¼š
- Android ç”Ÿå‘½å‘¨æœŸå¤æ‚ä½†ä¸€æ—¦ç†è§£å°±å¾ˆåˆç†
- åŸç”Ÿè§£å†³æ–¹æ¡ˆå¸¸å¸¸èƒœè¿‡ç¬¬ä¸‰æ–¹åº“
- åç¨‹å¾ˆä¼˜é›…ï¼ˆæ¯”çº¿ç¨‹/å›è°ƒå¥½ï¼‰
- Room æ¯” Core Data ç®€å•å¾—æƒŠäºº

**å·¥ç¨‹åŸåˆ™**ï¼š
- KISSï¼ˆä¿æŒç®€å•ï¼Œç¬¨è›‹ï¼‰- å›¾è¡¨è§£å†³æ–¹æ¡ˆè¯æ˜äº†è¿™ä¸€ç‚¹
- æ–‡æ¡£å’Œä»£ç ä¸€æ ·é‡è¦
- æµ‹è¯•ä»é•¿è¿œçœ‹èŠ‚çœæ—¶é—´
- æ¶æ„æ¯”åŠŸèƒ½æ›´é‡è¦

**iOS vs Android**ï¼š
- Android ä¸åŒï¼Œä½†ä¸éš¾
- iOS ç»éªŒå®é™…ä¸Šæœ‰å¸®åŠ©ï¼ˆæ¶æ„ã€å¼‚æ­¥æ¦‚å¿µï¼‰
- æ¯ä¸ªå¹³å°éƒ½æœ‰ç‹¬ç‰¹ä¼˜åŠ¿
- è·¨å¹³å°æ€ç»´å¾ˆæœ‰ä»·å€¼

### 8.5 å…³äºTeslaï¼Œæˆ‘æ‹¥æœ‰çš„

**æŠ€æœ¯æŠ€èƒ½**ï¼š
- å¿«é€Ÿå­¦ä¹ èƒ½åŠ›ï¼ˆ4 å‘¨ä» iOS åˆ° Androidï¼‰
- æ‰å®çš„æ¶æ„åŸºç¡€ï¼ˆMVVMã€Clean Codeï¼‰
- é—®é¢˜è§£å†³åˆ›é€ åŠ›
- è·¨å¹³å°æ€ç»´ï¼ˆå¯ä»¥åš iOSã€Android æˆ–ä¸¤è€…ï¼‰

**å·¥ç¨‹æ€ç»´**ï¼š
- ç¬¬ä¸€æ€§åŸç†æ€è€ƒï¼ˆä¸ºä»€ä¹ˆ vs æ˜¯ä»€ä¹ˆï¼‰
- æ³¨é‡è´¨é‡çš„å¼€å‘
- æ–‡æ¡£çºªå¾‹
- æŒç»­æ”¹è¿›æ€åº¦

**è½¯æŠ€èƒ½**ï¼š
- è‡ªä¸»å­¦ä¹ 
- çº¦æŸä¸‹çš„è¶³æ™ºå¤šè°‹
- æ¸…æ™°çš„æŠ€æœ¯æ²Ÿé€š
- æˆé•¿å‹æ€ç»´ï¼ˆä»0åˆ°1.2ä¸‡å±•ç¤ºé‡çš„æŠ€æœ¯åšå®¢ï¼‰

---

## æ€»ç»“

è¿™ä¸ªé¡¹ç›®ä¸ä»…ä»…æ˜¯ä¸€ä¸ªåŠŸèƒ½æ€§çš„ Android åº”ç”¨â€”â€”å®ƒå±•ç¤ºäº†æˆ‘**å¿«é€Ÿå­¦ä¹ **ã€**åˆ›é€ æ€§è§£å†³é—®é¢˜**å’Œåœ¨ç°å®çº¦æŸä¸‹**äº¤ä»˜é«˜è´¨é‡ä»£ç **çš„èƒ½åŠ›ã€‚

ä» iOS å¼€å‘è€…åˆ°æ„å»ºè¿™ä¸ª Android åº”ç”¨çš„æ—…ç¨‹æ•™ä¼šæˆ‘ï¼Œå¹³å°åªæ˜¯å·¥å…·ï¼›çœŸæ­£çš„æŠ€èƒ½æ˜¯**æ¶æ„æ€ç»´**ã€**é—®é¢˜è§£å†³**å’Œ**é€‚åº”èƒ½åŠ›**ã€‚å½“å›¾è¡¨åº“ä¾èµ–å¤±è´¥æ—¶ï¼Œæˆ‘æ²¡æœ‰æ”¾å¼ƒæˆ–å¦¥åâ€”â€”æˆ‘åˆ›æ–°äº†ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚å½“ Android çš„ç”Ÿå‘½å‘¨æœŸå¤æ‚æ€§çœ‹èµ·æ¥ä»¤äººç”Ÿç•æ—¶ï¼Œæˆ‘æ·±å…¥å­¦ä¹ ç›´åˆ°ç†è§£ä¸ºæ­¢ã€‚

æˆ‘å¯¹æœ‰æœºä¼šå°†è¿™ç§å­¦ä¹ æ•æ·æ€§å’Œé—®é¢˜è§£å†³æ–¹æ³•å¸¦åˆ° Tesla æ„Ÿåˆ°å…´å¥‹ï¼Œé‚£é‡Œå¿«é€Ÿåˆ›æ–°å’Œç¬¬ä¸€æ€§åŸç†æ€ç»´æ˜¯æ ¸å¿ƒä»·å€¼ã€‚æ— è®ºæ˜¯ iOSã€Android è¿˜æ˜¯ä»»ä½•æ–°å…´å¹³å°ï¼Œæˆ‘å¯¹è‡ªå·±å¿«é€Ÿå­¦ä¹ å¹¶åšå‡ºæœ‰æ„ä¹‰è´¡çŒ®çš„èƒ½åŠ›å……æ»¡ä¿¡å¿ƒã€‚

æ„Ÿè°¢è¿™ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§å’Œæ•™è‚²æ„ä¹‰çš„ take-home é¡¹ç›®ã€‚æ”¶ç›Šé¢‡ä¸°ã€‚

---